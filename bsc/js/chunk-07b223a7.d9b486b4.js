(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07b223a7"],{"16f7":function(t,s,e){t.exports=e.p+"img/nft-empty.2ab13a23.svg"},"26f7":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"popups"},[i("div",{class:"nft-pledge "+t.theme},[i("div",{staticClass:"header"},[i("span",[t._v("质押NFT")]),i("van-icon",{attrs:{name:"cross"},on:{click:t.toggle}})],1),i("span",[t._v("选择需要质押的NFT")]),i("div",{staticClass:"nft-list"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.list.length<=0,expression:"list.length <= 0"}],staticClass:"empty"},[i("img",{attrs:{src:e("16f7")}}),i("span",[t._v("未发现地址下持有NFT")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.list.length>0,expression:"list.length > 0"}],staticClass:"list-container"},t._l(t.list,(function(s){return i("div",{key:s.id,staticClass:"list-item"},[i("div",{staticClass:"checkbox",on:{click:function(t){s.checked=!s.checked}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:s.checked,expression:"item.checked"}],attrs:{src:e("d909")}})]),i("span",[t._v("#"),i("span",[t._v(t._s(s.id))])])])})),0)]),i("div",{staticClass:"all-in"},[i("div",{staticClass:"checkbox",on:{click:t.checkAll}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.isCheckAll,expression:"isCheckAll"}],attrs:{src:e("d909")}})]),i("span",[t._v("全选")])]),i("button",{staticClass:"ant-btn",attrs:{loading:t.trading,disabled:t.trading||0===t.checkedNFTList.length},on:{click:t.depositNFT}},[t._v(t._s(t.btnText))])])])},n=[],a=e("1da1"),c=e("5530"),r=(e("96cf"),e("4de4"),e("a9e3"),e("d81d"),e("aca7")),o={data:function(){return{show:!1,list:[],isApproved:!1,trading:!1,address:this.$address}},computed:Object(c["a"])(Object(c["a"])({},Vuex.mapState(["contracts","address","theme"])),{},{btnText:function(){return this.trading?"区块确认中":0===this.checkedNFTList.length?"选择NFT":this.isApproved?"确认":"授权"},isCheckAll:function(){return 0!==this.list.length&&this.checkedNFTList.length===this.list.length},checkedNFTList:function(){return this.list.filter((function(t){return t.checked}))}}),created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.$contracts.AcNft.methods.balanceOf(t.address).call({from:t.address},(function(s,e){s||t.getNFTList(Number(e))})),t.$contracts.AcNft.methods.isApprovedForAll(t.address,t.$contracts.Farm.options.address).call({from:t.address},(function(s,e){s||(t.isApproved=e)}));case 2:case"end":return s.stop()}}),s)})))()},checkAll:function(){var t=this;this.list=this.list.map((function(s){return Object(c["a"])(Object(c["a"])({},s),{},{checked:!t.isCheckAll})}))},toggle:function(){this.show=!this.show},setApprovalForAll:function(){var t=this;this.$contracts.AcNft.methods.setApprovalForAll(this.$contracts.Farm.options.address,!0).send({from:this.address}).on("transactionHash",(function(s){t.trading=!0})).on("receipt",(function(s){vant.Toast.success("授权成功！"),t.isApproved=!0,t.trading=!1})).on("error",(function(s){t.trading=!1}))},depositNFT:function(){var t=this;if(!this.isApproved)return this.setApprovalForAll();var s=this.$contracts.Farm.methods.depositNFT(r["b"].NFT,this.checkedNFTList.map((function(t){return t.id})),this.address);s.call({from:this.address},(function(e,i){e||s.send({from:t.address}).on("transactionHash",(function(s){t.trading=!0})).on("receipt",(function(s){vant.Toast.success("质押成功！"),t.$emit("reload"),t.trading=!1})).on("error",(function(s){t.trading=!1}))}))},getNFTList:function(t){var s=this;if(0!==t){for(var e=new this.$web3.BatchRequest,i=0;i<t;i++)e.add(this.$contracts.AcNft.methods.tokenOfOwnerByIndex(this.address,i).call.request({from:this.address}));e.requestManager.sendBatch(e.requests,(function(t,e){t||(s.list=e.map((function(t){return{id:t.result.decode(["uint256"]),checked:!1}})))}))}else this.list=[]}}},d=o,l=d,h=(e("6382"),e("2877")),u=Object(h["a"])(l,i,n,!1,null,"1109ed92",null);s["default"]=u.exports},6382:function(t,s,e){"use strict";e("bb79")},bb79:function(t,s,e){},d909:function(t,s,e){t.exports=e.p+"img/checked.f599428c.svg"}}]);