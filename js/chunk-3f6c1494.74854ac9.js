(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f6c1494"],{"16f7":function(s,t,e){s.exports=e.p+"img/nft-empty.a7e47f62.svg"},2021:function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s._self._c;s._self._setupProxy;return t("div",{directives:[{name:"show",rawName:"v-show",value:s.show,expression:"show"}],staticClass:"popups"},[t("div",{staticClass:"board-pledge"},[t("div",{staticClass:"header"},[t("span",[s._v(s._s(s.$t("pledge_symbol",{symbol:"BOD"})))]),t("van-icon",{attrs:{name:"cross"},on:{click:s.toggle}})],1),t("span",[s._v(s._s(s.$t("board_tips.tip1",{symbol:"BOD"})))]),t("div",{staticClass:"nft-list"},[t("div",{directives:[{name:"show",rawName:"v-show",value:s.list.length<=0,expression:"list.length <= 0"}],staticClass:"empty"},[t("img",{attrs:{src:e("16f7")}}),t("span",[s._v(s._s(s.$t("board_tips.tip2",{symbol:"BOD"})))])]),t("div",{directives:[{name:"show",rawName:"v-show",value:s.list.length>0,expression:"list.length > 0"}],staticClass:"list-container"},s._l(s.list,(function(i){return t("div",{key:i.id,staticClass:"list-item"},[t("div",{staticClass:"checkbox",on:{click:function(s){i.checked=!i.checked}}},[t("img",{directives:[{name:"show",rawName:"v-show",value:i.checked,expression:"item.checked"}],attrs:{src:e("d909")}})]),t("span",[s._v("#"),t("span",[s._v(s._s(i.id))])])])})),0)]),t("div",{staticClass:"all-in"},[t("div",{staticClass:"checkbox",on:{click:s.checkAll}},[t("img",{directives:[{name:"show",rawName:"v-show",value:s.isCheckAll,expression:"isCheckAll"}],attrs:{src:e("d909")}})]),t("span",[s._v(s._s(s.$t("nftPledge.text4")))])]),t("van-button",{attrs:{disabled:s.disabled,loading:s.trading,"loading-text":s.$t("transacting")},on:{click:s.depositNFT}},[s._v(s._s(s.btnText))])],1)])},a=[],c=(e("f8b6"),e("36ad")),n=(e("6f0a"),e("bdaf")),o={components:{[n["a"].name]:n["a"]},data(){return{show:!1,list:[],isApproved:!1,trading:!1,address:this.$address}},computed:{disabled(){return this.trading||0===this.checkedNFTList.length},btnText(){return 0===this.checkedNFTList.length?this.$t("select_symbol",{symbol:"BOD"}):this.isApproved?this.$t("confirm"):this.$t("approve")},isCheckAll(){return 0!==this.list.length&&this.checkedNFTList.length===this.list.length},checkedNFTList(){return this.list.filter(s=>s.checked)}},created(){this.$contracts&&this.init()},methods:{init(){this.$contracts.AcDAO.methods.balanceOf(this.$address).call((s,t)=>{s||this.getNFTList(Number(t))}),this.$contracts.AcDAO.methods.isApprovedForAll(this.$address,this.$contracts.Farm.options.address).call((s,t)=>{s||(this.isApproved=t)})},checkAll(){this.list=this.list.map(s=>({...s,checked:!this.isCheckAll}))},toggle(){this.show=!this.show},setApprovalForAll(){this.trading=!0,this.$contracts.AcDAO.methods.setApprovalForAll(this.$contracts.Farm.options.address,!0).send({from:this.$address}).on("receipt",()=>{c["a"].success(this.$t("nftPledge.text9")),this.isApproved=!0,this.trading=!1,this.depositNFT()}).on("error",s=>{this.trading=!1,console.log(s)})},async depositNFT(){if(!this.isApproved)return this.setApprovalForAll();this.trading=!0;const s=this.$contracts.Farm.methods.deposit(this.$contracts.AcDAO.options.address,this.checkedNFTList.map(s=>s.id));try{await s.call({from:this.$address}),s.send({from:this.$address}).on("receipt",()=>{this.$emit("reload"),c["a"].success(this.$t("nftPledge.text10")),this.trading=!1}).on("error",s=>{this.trading=!1,console.log(s)})}catch(t){this.trading=!1,console.log(t)}},getNFTList(s){if(0===s)return void(this.list=[]);const t=new this.$web3.BatchRequest;for(let e=0;e<s;e++)t.add(this.$contracts.AcDAO.methods.tokenOfOwnerByIndex(this.$address,e).call.request("latest"));t.requestManager.sendBatch(t.requests,(s,t)=>{s||(this.list=t.map(s=>({id:(s.result||s).decode(["uint256"]),checked:!1})))})}}},r=o,d=r,l=(e("bf18"),e("b01b")),h=Object(l["a"])(d,i,a,!1,null,"4a8dcd18",null);t["default"]=h.exports},"65b0":function(s,t,e){},"6f0a":function(s,t,e){"use strict";e("1651"),e("8c1d"),e("6bf5")},bf18:function(s,t,e){"use strict";e("65b0")},d909:function(s,t,e){s.exports=e.p+"img/checked.7169b113.svg"}}]);