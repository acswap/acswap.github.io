(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61869ff4"],{"0a29":function(t,s,e){"use strict";e("fb99")},6501:function(t,s,e){t.exports=e.p+"img/liquidity.4ed209f7.svg"},"9b90":function(t,s,e){t.exports=e.p+"img/pool-empty.8e626e2f.svg"},"9e58":function(t,s,e){t.exports=e.p+"img/Thearrow1.24ed6bd1.svg"},df8f:function(t,s,e){"use strict";e.r(s);e("d999");var i=function(){var t=this,s=t._self._c;t._self._setupProxy;return s("div",{staticClass:"add"},[s("div",{staticClass:"box"},[s("div",{staticClass:"just-swap"},[s("div",{staticClass:"content"},[s("div",{staticClass:"form"},[s("div",{staticClass:"input"},[s("div",{staticClass:"container"},[s("div",{on:{click:function(s){return t.openSearch("token0")}}},[s("img",{attrs:{src:t.token0.logoURI}}),s("span",[t._v(t._s(t.token0.symbol))]),s("img",{attrs:{src:e("9e58")}})]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.amount0,expression:"amount0"}],attrs:{type:"number",placeholder:"0"},domProps:{value:t.amount0},on:{input:[function(s){s.target.composing||(t.amount0=s.target.value)},t.inputAmount0]}})]),s("span",[t._v(t._s(t.$t("transaction.text2"))+" "+t._s(t.balance0.toFixed()))])]),t._m(0),s("div",{staticClass:"input"},[s("div",{staticClass:"container"},[s("div",{on:{click:function(s){return t.openSearch("token1")}}},[s("img",{attrs:{src:t.token1.logoURI}}),s("span",[t._v(t._s(t.token1.symbol))]),s("img",{attrs:{src:e("9e58")}})]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.amount1,expression:"amount1"}],attrs:{type:"number",placeholder:"0"},domProps:{value:t.amount1},on:{input:[function(s){s.target.composing||(t.amount1=s.target.value)},t.inputAmount1]}})]),s("span",[t._v(t._s(t.$t("transaction.text2"))+" "+t._s(t.balance1.toFixed()))])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.amount0.toBN().gt(0)&&t.pairAddress,expression:"amount0.toBN().gt(0) && pairAddress"}],staticClass:"info"},[s("div",{staticClass:"info-item rate"},[s("span",[t._v(t._s(t.$t("joinFundPool.text5")))]),s("div",[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.rerate,expression:"!rerate"}]},[t._v(t._s(`1 ${t.token0.symbol}≈${t.rate1.toFixed()} ${t.token1.symbol}`))]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.rerate,expression:"rerate"}]},[t._v(t._s(`1 ${t.token1.symbol}≈${t.rate0.toFixed()} ${t.token0.symbol}`))]),s("img",{attrs:{src:e("fe12")},on:{click:function(s){t.rerate=!t.rerate}}})])]),s("div",{staticClass:"info-item padding-right"},[s("span",[t._v("AMM")]),s("span",[t._v(t._s(t.poolType))])]),s("div",{staticClass:"info-item padding-right"},[s("span",[t._v(t._s(t.$t("add.text1")))]),s("span",[t._v("$"+t._s(t.reserveUSD))])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.amount0.toBN().gt(0),expression:"amount0.toBN().gt(0)"}],staticClass:"info-item padding-right"},[s("span",[t._v(t._s(t.$t("add.text2")))]),s("span",[t._v(t._s(t.poolProp))])])]),s("van-button",{on:{click:t.addLiquidity}},[t._v(t._s(t.btnText))])],1),s("search-tokens",{ref:"searchTokens",on:{select:t.select}}),s("fundpool-state",{attrs:{state:t.state,token0:{amount:t.amount0,symbol:t.token0.symbol},token1:{amount:t.amount1,symbol:t.token1.symbol},waitApprove:t.waitApprove,lp:t.liquidity,rate:t.rate1,reRate:t.rate0,prop:t.poolProp},on:{addLiquidity:t.addLiquidity,close:t.close}})],1),s("span",{directives:[{name:"show",rawName:"v-show",value:t.assetsPool,expression:"assetsPool"}],staticClass:"title"},[t._v(t._s(t.$t("add.text3")))]),t.assetsPool?s("div",{staticClass:"your-share"},[s("span",{staticClass:"badge"},[t._v("cake v2")]),s("div",{staticClass:"tokens"},[s("div",[s("div",[s("img",{attrs:{src:t.assetsPool.logo0}}),s("img",{attrs:{src:t.assetsPool.logo1}})]),s("span",[t._v(t._s(t.assetsPool.symbol0)+"/"+t._s(t.assetsPool.symbol1))])]),s("div",[s("span",[t._v("LP: "+t._s(t.assetsPool.lp.toFixed()))]),s("span",[t._v(t._s(t.assetsPool.myShare)+"%")])])]),s("div",{staticClass:"amounts"},[s("div",[s("span",[t._v(t._s(t.assetsPool.symbol0)+": "+t._s(t.assetsPool.amount0.toFixed()))]),s("span",[t._v(t._s(t.assetsPool.symbol1)+": "+t._s(t.assetsPool.amount1.toFixed()))])]),s("van-button",{on:{click:function(s){t.$router.push({path:"/liquidity/remove",query:{info:JSON.stringify(t.assetsPool)}})}}},[t._v(t._s(t.$t("joinFundPool.text11")))])],1)]):t._e(),t.assetsPool?t._e():s("div",{staticClass:"not-liquidity"},[s("img",{attrs:{src:e("9b90")}}),s("span",[t._v(t._s(t.$t("joinFundPool.text16")))])])])])},o=[function(){var t=this,s=t._self._c;t._self._setupProxy;return s("div",{staticClass:"plus"},[s("img",{attrs:{src:e("6501")}})])}],a=(e("14b9"),e("d774")),n=e("6eef"),r=e("aca7"),d=e("e549"),h=e("1b4b"),l={components:{"mk-navbar":()=>e.e("chunk-c1fd023c").then(e.bind(null,"0861")),"search-tokens":()=>Promise.all([e.e("chunk-76924134"),e.e("chunk-2d0b5d39")]).then(e.bind(null,"bab4")),"fundpool-state":()=>e.e("chunk-2d224af0").then(e.bind(null,"e0d3"))},data(){return{token0:r["a"],token1:r["b"],balance0:0,balance1:0,contract0:null,contract1:null,allowance0:"0".toBN(),allowance1:"0".toBN(),reserve0:0,reserve1:0,amount0:"",amount1:"",inputing0:!1,inputing1:!1,rerate:!1,state:"none",pairAddress:null,totalLiquidity:0,assetsPool:null,reserveUSD:""}},computed:{...Object(n["b"])(["chainId","slippage","deadline"]),pairContract(){return this.pairAddress?0==this.chainId?window.tronWeb.contract(d,this.pairAddress):new this.$web3.eth.Contract(d,this.pairAddress):null},btnText(){const t=h["a"][this.chainId].mainCoin;return["approve","in"].includes(this.state)?this.$t("add.text4"):this.pairContract?this.token0.symbol!==t.symbol&&this.amount0.toBN().gt(this.allowance0)?this.$t("add.text6",{symbol:this.token0.symbol}):this.token1.symbol!==t.symbol&&this.amount1.toBN().gt(this.allowance1)?this.$t("add.text6",{symbol:this.token1.symbol}):this.$t("add.text7"):this.$t("add.text5")},rate0(){return this.pairAddress?"1".toWei(this.token1.decimals).toBN().times(this.reserve0).div(this.reserve1).toFixed().fromWei(this.token0.decimals).toFixed(4):"--"},rate1(){return this.pairAddress?"1".toWei(this.token0.decimals).toBN().times(this.reserve1).div(this.reserve0).toFixed().fromWei(this.token1.decimals).toFixed(4):"--"},poolProp(){return["","0"].includes(this.amount0)||!this.pairAddress?"--":this.amount0.toWei(this.token0.decimals).toBN().div(this.reserve0.toBN().plus(this.amount0.toWei(this.token0.decimals))).times(100).toFixed().toFixed(6)+"%"},liquidity(){if(this.reserve0.toBN().gt(0)){const t=this.amount0.toWei(this.token0.decimals).toBN().times(this.totalLiquidity).div(this.reserve0),s=this.amount1.toWei(this.token1.decimals).toBN().times(this.totalLiquidity).div(this.reserve1);return(t.lt(s)?t:s).toFixed(0).fromWei(18)}return this.amount0.toWei(this.token0.decimals).toBN().times(this.amount1.toWei(this.token1.decimals)).sqrt().toFixed(0).fromWei(18)},waitApprove(){const t=[],s=h["a"][this.chainId].mainCoin;return this.token0.symbol!==s.symbol&&this.allowance0.lt(this.amount0.toWei(this.token0.decimals))&&t.push({who:"0",...this.token0}),this.token1.symbol!==s.symbol&&this.allowance1.lt(this.amount1.toWei(this.token1.decimals))&&t.push({who:"1",...this.token1}),t},poolType(){switch(this.chainId){case 0:return"sunswap v2";case 1:return"uniswap v2";case 56:return"cake v2";case 66:return"kswap";case 128:return"mdex";case 137:return"quickswap";default:return"cake v2"}}},destroyed(){clearInterval(this.interval)}},c=e("b9cc"),u={...l,created(){const t=h["a"][this.chainId];this.token0=t.mainCoin,this.token1=t.defaultCoin,this.$address&&(this.select({token:this.token0,who:"token0"}),this.interval=setInterval(()=>{"none"===this.state&&this.select({token:this.token0,who:"token0"})},1e4))},methods:{message(){return a["a"].fail("暂未开放！")},openSearch(t){this.$refs.searchTokens.open(t)},close(){this.state="none",this.amount0="",this.amount1="",this.select({token:this.token0,who:"token0"})},switch(){const t=this.token0;this.token0=this.token1,this.token1=t,this.select({token:this.token0,who:"token0"})},inputAmount0(){return!!this.pairAddress&&(this.inputing1?this.inputing1=!1:["","0"].includes(this.amount0)?this.amount1="":(this.inputing0=!0,void(this.amount1=this.amount0.toWei(this.token0.decimals).toBN().times(this.reserve1).div(this.reserve0).toFixed().fromWei(this.token1.decimals).toFixed(6))))},inputAmount1(){return!!this.pairAddress&&(this.inputing0?this.inputing0=!1:["","0"].includes(this.amount1)?this.amount0="":(this.inputing1=!0,void(this.amount0=this.amount1.toWei(this.token1.decimals).toBN().times(this.reserve0).div(this.reserve1).toFixed().fromWei(this.token0.decimals).toFixed(6))))},approve(){const t=0==this.chainId?window.tronWeb.contract(c,this.waitApprove[0].address):new this.$web3.eth.Contract(c,this.waitApprove[0].address),s=Number(this.waitApprove[0].symbol===this.token1.symbol),e=(0==this.chainId?t:t.methods).approve((0==this.chainId?this.$Router:this.$Router.options).address,this["amount"+s].toWei(this.waitApprove[0].decimals)).send({from:this.$address});0==this.chainId?e.then(async e=>{if(this.state="approve",await this.$loading(e)){const e=await t.allowance(this.$address,this.$Router.address).call({from:this.$address});this["allowance"+s]=e._hex.toBN(),this.waitApprove.length>0?this.approve():this.state="approved"}else this.state="none"}):e.on("transactionHash",t=>{this.state="approve"}).on("receipt",async e=>{this["allowance"+s]=(await t.methods.allowance(this.$address,this.$Router.options.address).call({from:this.$address})).toBN(),this.waitApprove.length>0?this.approve():this.state="approved"}).on("error",t=>{this.state="none"})},addLiquidity(){const t=h["a"][this.chainId].mainCoin;if(this.balance0.toBN().lt(this.amount0))return a["a"].fail(`${this.token0.symbol}${this.$t("joinFundPool.text13")}`);if(this.balance1.toBN().lt(this.amount1))return a["a"].fail(`${this.token1.symbol}${this.$t("joinFundPool.text13")}`);if(this.waitApprove.length>0)return this.approve();if([this.token0.symbol,this.token1.symbol].includes(t.symbol))return this.addLiquidityETH();const s=this.amount0.toWei(this.token0.decimals),e=this.amount1.toWei(this.token1.decimals),i=s.toBN().div(100).times(this.slippage).toFixed(0),o=e.toBN().div(100).times(this.slippage).toFixed(0),n=Math.floor((new Date).getTime()/1e3)+this.deadline,r=(0==this.chainId?this.$Router:this.$Router.methods).addLiquidity(this.token0.address,this.token1.address,s,e,i,o,this.$address,n).send({from:this.$address});0==this.chainId?r.then(async t=>{this.state="in",this.state=await this.$loading(t)?"done":"none"}):r.on("transactionHash",t=>{this.state="in"}).on("receipt",t=>{this.state="done"}).on("error",t=>{this.state="none"})},addLiquidityETH(){const t=h["a"][this.chainId].mainCoin,s=this.token0.symbol===t.symbol?"1":"0",e=this.token0.symbol===t.symbol?"0":"1",i=this["amount"+s].toWei(this["token"+s].decimals),o=i.toBN().div(100).times(this.slippage).toFixed(0),a=this["amount"+e].toWei(this["token"+e].decimals),n=a.toBN().div(100).times(this.slippage).toFixed(0),r=Math.floor((new Date).getTime()/1e3)+this.deadline,d=(0==this.chainId?this.$Router:this.$Router.methods).addLiquidityETH(this["token"+s].address,i,o,n,this.$address,r).send({from:this.$address,[0==this.chainId?"callValue":"value"]:a});0==this.chainId?d.then(async t=>{this.state="in",this.state=await this.$loading(t)?"done":"none"}):d.on("transactionHash",t=>{this.state="in"}).on("receipt",t=>{this.state="done"}).on("error",t=>{this.state="none"})},select({token:t,who:s}){if("token0"===s&&this.token1.symbol===t.symbol)return this.switch();if("token1"===s&&this.token0.symbol===t.symbol)return this.switch();this[s]=t;const e=h["a"][this.chainId].mainCoin;if(0==this.chainId){const t=[],s="balanceOf(address)".encodeFunction(["address"],[this.$address]),i=[this.$Multicall.address.toHex(),"getEthBalance(address)".encodeFunction(["address"],[this.$address])],o="allowance(address,address)".encodeFunction(["address","address"],[this.$address,this.$Router.address]);this.token0.symbol===e.symbol?t.push(i):t.push([this.token0.address.toHex(),s]),this.token1.symbol===e.symbol?t.push(i):t.push([this.token1.address.toHex(),s]),t.push([this.token0.address.toHex(),o]),t.push([this.token1.address.toHex(),o]),t.push([this.$Factory.address.toHex(),"getPair(address,address)".encodeFunction(["address","address"],[this.token0.address,this.token1.address])]),window.tronWeb.transactionBuilder.triggerConstantContract(this.$Multicall.address,"aggregate((address,bytes)[])",{},[{type:"(address,bytes)[]",value:t}],this.$address).then(t=>{const{returnData:s}=t.constant_result[0].decode([{name:"blockNumber",type:"uint256"},{name:"returnData",type:"bytes[]"}]),e=s[4].decode(["address"]);if(this.balance0=s[0].fromWei(this.token0.decimals),this.balance1=s[1].fromWei(this.token1.decimals),this.allowance0=s[2].toBN(),this.allowance1=s[3].toBN(),this.pairAddress=0!==Number(e)?e:null,this.pairAddress){const t=[];t.push([e,"getReserves()".encodeFunction()]),t.push([e,"totalSupply()".encodeFunction()]),t.push([e,"balanceOf(address)".encodeFunction(["address"],[this.$address])]),window.tronWeb.transactionBuilder.triggerConstantContract(this.$Multicall.address,"aggregate((address,bytes)[])",{},[{type:"(address,bytes)[]",value:t}],this.$address).then(t=>{const{returnData:s}=t.constant_result[0].decode([{name:"blockNumber",type:"uint256"},{name:"returnData",type:"bytes[]"}]),{_reserve0:i,_reserve1:o}=s[0].decode([{type:"uint112",name:"_reserve0"},{type:"uint112",name:"_reserve1"}]),a=this.token0.address.toHex().toBN().lt(this.token1.address.toHex().toBN()),n=s[2].toBN();this.reserve0=a?i:o,this.reserve1=a?o:i,this.totalLiquidity=s[1].toBN(),n.gt(0)&&(this.assetsPool={logo0:this.token0.logoURI,logo1:this.token1.logoURI,symbol0:this.token0.symbol,symbol1:this.token1.symbol,amount0:n.times(this.reserve0).div(this.totalLiquidity).toFixed(0).fromWei(this.token0.decimals),amount1:n.times(this.reserve1).div(this.totalLiquidity).toFixed(0).fromWei(this.token1.decimals),reserve0:this.reserve0,reserve1:this.reserve1,lp:n.toFixed().fromWei(18),myShare:n.div(this.totalLiquidity).times(100).toFixed().toFixed(6),address0:this.token0.address,address1:this.token1.address,decimals0:this.token0.decimals,decimals1:this.token1.decimals,address:e})}),Object(r["g"])(e.fromHex()).then(t=>{this.reserveUSD=parseInt(t.liquidity)})}})}else{const t=new this.$web3.BatchRequest,s=new this.$web3.eth.Contract(c,this.token0.address),i=new this.$web3.eth.Contract(c,this.token1.address);this.token0.symbol===e.symbol?t.add(this.$web3.eth.getBalance.request(this.$address,"latest")):t.add(s.methods.balanceOf(this.$address).call.request({from:this.$address})),this.token1.symbol===e.symbol?t.add(this.$web3.eth.getBalance.request(this.$address,"latest")):t.add(i.methods.balanceOf(this.$address).call.request({from:this.$address})),t.add(s.methods.allowance(this.$address,this.$Router._address).call.request({from:this.$address})),t.add(i.methods.allowance(this.$address,this.$Router._address).call.request({from:this.$address})),t.add(this.$Factory.methods.getPair(this.token0.address,this.token1.address).call.request({from:this.$address})),t.requestManager.sendBatch(t.requests,(t,s)=>{if(t)console.log(s),console.log(t);else{const t=s[4].result.decode(["address"]);if(this.balance0=("string"===typeof s[0]?s[0]:s[0].result).fromWei(this.token0.decimals).toFixed(2),this.balance1=s[1].result.fromWei(this.token1.decimals).toFixed(2),this.allowance0=s[2].result.toBN(),this.allowance1=s[3].result.toBN(),this.pairAddress=0!==Number(t)?t:null,this.pairAddress){const s=new this.$web3.BatchRequest;s.add(this.pairContract.methods.getReserves().call.request({from:this.$address})),s.add(this.pairContract.methods.totalSupply().call.request({from:this.$address})),s.add(this.pairContract.methods.balanceOf(this.$address).call.request({from:this.$address})),s.requestManager.sendBatch(s.requests,(s,e)=>{if(!s){const{_reserve0:s,_reserve1:i}=("string"===typeof e[0]?e[0]:e[0].result).decode([{type:"uint112",name:"_reserve0"},{type:"uint112",name:"_reserve1"}]),o=this.token0.address.toBN().lt(this.token1.address.toBN()),a=e[2].result.toBN();this.reserve0=o?s:i,this.reserve1=o?i:s,this.totalLiquidity=e[1].result.toBN(),a.gt(0)&&(this.assetsPool={logo0:this.token0.logoURI,logo1:this.token1.logoURI,symbol0:this.token0.symbol,symbol1:this.token1.symbol,amount0:a.times(this.reserve0).div(this.totalLiquidity).toFixed(0).fromWei(this.token0.decimals),amount1:a.times(this.reserve1).div(this.totalLiquidity).toFixed(0).fromWei(this.token1.decimals),reserve0:this.reserve0,reserve1:this.reserve1,lp:a.toFixed().fromWei(18),myShare:a.div(this.totalLiquidity).times(100).toFixed().toFixed(6),address0:this.token0.address,address1:this.token1.address,decimals0:this.token0.decimals,decimals1:this.token1.decimals,pair:t})}}),Object(r["f"])(t.toLowerCase(),h["c"][this.chainId]).then(t=>{this.reserveUSD=parseInt(t.reserveUSD)})}}})}}}},m=u,p=m,v=(e("0a29"),e("c6fb")),k=Object(v["a"])(p,i,o,!1,null,"b43c774a",null);s["default"]=k.exports},fb99:function(t,s,e){},fe12:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAACnklEQVRIS8WWsWsTYRjGn+dyhVKqOFiooFAFseriUhB0SMFBQVDQaC8UvOYU2uSgih39D6xQMalWTLxBesFWEBwcFMygODrUYqdOSjs4BBq02ORe+dJeTWKqRO/01u+753fP+73f8x4R0hMfSp0RDY8I3pjOpm83YhgSF0YieZ3Uxjf0rzbCQwNHo1F9177DLsnzCi7wht3s5JRvNDSwAtTCBShDMODm0k/UWqjgX8E3wWdNc0eH1jEq4AkAu4M8e5K6r+k7r4IvWPaxiMgsye4ggVtqCYqMmcluPcI5gjsB+SweJ4Tep6A/gKBF8viG7jjjln0TwBiAj2sVr2/GmVwOGhq37FEAE+vdLQ/cbOYKjYT9gUSvJ5WRfO7uvVChIrNLi/NGoVAoK8eiYF4F/XknXQgSXOe0Blq9TmGBjYR9jsRstbwN0FDBvttm0FDBStww7V7XSS80Oz4alj0HoOdrpbTnqeMUgzzjWq14wrYASQs4qGKTKk+7ug61z8xMlsKCKt24lXoI0Ny8TlvBoqbZrtYKjrMaxAf5YECc6WxmqOmQGEyMHPAYeSkienlF9gdRjd+CB8zhHmqRtyq3RWQ5aLCITLi5zLU6xyq32zTtFYheBYW31u8695t2Zavlj1updwCPiHDMzd25tQmuhUKwsOZ5/UHl9sCQfVHTkK+GSeXbQWWmCq5zCilpHi974F8PC9E8nYLTIG0CukDybjZjVAOkzmmr9Wthv4i8Lq/IKb9RaVipSwSdFjRa2CqrInwvEGd5cX5KTSX/ZcZiyU59G5+rIS2QUgU8+TibftOC+h9tXT/j/wD/0dWxZGfbdu0FgKP/wvnW9zjksv8UmQ33ufjFK+0NY2o1zer1P0/tGYD2pUqpL6hBUduF3wHhjnJzZY6yMwAAAABJRU5ErkJggg=="}}]);