(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7d603cbf"],{"238d":function(t,s,e){"use strict";e("c9b0")},"5db4":function(t,s,e){"use strict";e.r(s);var n=function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("van-overlay",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],on:{click:t.toggle}},[n("div",{class:"buy-nft "+t.theme,on:{click:function(t){t.stopPropagation()}}},[n("span",{staticClass:"title"},[t._v(t._s(t.$t("buyNft.text1")))]),n("div",{staticClass:"info"},[n("img",{attrs:{src:e("43fc")}}),n("div",[n("span",[t._v("AcSwap NFT")]),n("span",[t._v("AcSwap #"+t._s(t.tokenId))]),n("span",[t._v(t._s(t.$t("buyNft.text2"))),n("span",[t._v(t._s(t.tokenId))])])])]),n("div",{staticClass:"payments"},[n("div",[n("span",[t._v(t._s(t.$t("buyNft.text3")))]),n("div",{staticClass:"btn"},[n("span",{class:{active:"FSV"===t.method},on:{click:function(s){t.method="FSV"}}},[t._v("FSV")]),n("span",{class:{active:"USDT"===t.method},on:{click:function(s){t.method="USDT"}}},[t._v("USDT")])])]),n("div",[n("span",[t._v(t._s(t.$t("buyNft.text4")))]),n("div",{staticClass:"column"},[n("span",[t._v(t._s(("FSV"===t.method?t.fsvPrice:t.usdtPrice).toFixed()))]),n("span",[t._v("($"+t._s(("FSV"===t.method?t.buyNftFsvPrice:t.usdtPrice).toFixed(0))+")")])])]),n("div",[n("span",[t._v(t._s(t.$t("buyNft.text5",{symbol:t.method}))+" ")]),n("div",{staticClass:"column"},[n("span",[t._v(t._s(("FSV"===t.method?t.fsvBalance:t.usdtBalance).toFixed()))]),n("span",[t._v("($"+t._s(("FSV"===t.method?t.fsvBalancePrice:t.usdtBalance).toFixed(0))+")")])])])]),n("span",{staticClass:"power"},[t._v(t._s(t.$t("buyNft.text6"))+" "),n("span",[t._v(t._s(("FSV"===t.method?t.fsvGetPower:t.usdtGetPower).toFixed(0)))])]),n("van-button",{attrs:{loading:t.trading,disabled:t.trading},on:{click:t.subscribe}},[t._v(t._s(t.btnText))])],1)])},a=[],i=e("1da1"),o=e("5530"),r=(e("96cf"),e("b680"),{props:{tokenId:String,usdtPrice:String,fsvPrice:String,buyNftFsvPrice:String,fsvGetPower:String,usdtGetPower:String},data:function(){return{method:"FSV",show:!1,fsvBalance:"0",fsvBalancePrice:"0",usdtBalance:"0",fsvAllowance:"0",usdtAllowance:"0",trading:!1}},computed:Object(o["a"])(Object(o["a"])({},Vuex.mapState(["theme"])),{},{btnText:function(){return this.trading?"区块确认中":"FSV"===this.method&&this.fsvAllowance.toBN().lt(this.fsvPrice)||"USDT"===this.method&&this.usdtAllowance.toBN().lt(this.usdtPrice)?"授权":"确认"}}),created:function(){this.$contracts&&this.init()},methods:{toggle:function(){this.show=!this.show},init:function(){var t=this,s=new this.$web3.BatchRequest;s.add(this.$contracts.FSVToken.methods.balanceOf(this.$address).call.request({from:this.$address})),s.add(this.$contracts.USDTToken.methods.balanceOf(this.$address).call.request({from:this.$address})),s.add(this.$contracts.FSVToken.methods.allowance(this.$address,this.$contracts.Genesis.options.address).call.request({from:this.$address})),s.add(this.$contracts.USDTToken.methods.allowance(this.$address,this.$contracts.Genesis.options.address).call.request({from:this.$address})),s.add(this.$contracts.Oracle.methods.getTokenPrice(this.$contracts.FSVToken.options.address,"1".toWei()).call.request({from:this.$address})),s.requestManager.sendBatch(s.requests,(function(s,e){s||(t.fsvBalance=("string"===typeof e[0]?e[0]:e[0].result).fromWei(),t.usdtBalance=e[1].result.fromWei(),t.fsvAllowance=e[2].result.fromWei(),t.usdtAllowance=e[3].result.fromWei(),t.fsvBalancePrice=e[0].result.toBN().times(e[4].result.fromWei()).toFixed().fromWei())}))},approve:function(){var t=this,s=this.$contracts["FSV"===this.method?"FSVToken":"USDTToken"],e=("FSV"===this.method?this.fsvPrice:this.usdtPrice).toBN().times(10).toFixed().toWei();s.methods.approve(this.$contracts.Genesis.options.address,e).send({from:this.$address}).on("transactionHash",(function(s){t.trading=!0})).on("receipt",function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.methods.allowance(t.$address,t.$contracts.Genesis.options.address).call({from:t.$address});case 2:a=e.sent,t["FSV"===t.method?"fsvAllowance":"usdtAllowance"]=a.fromWei(),vant.Toast.success("授权成功！"),t.trading=!1;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("error",(function(s){t.trading=!1}))},subscribe:function(){var t=this;if("FSV"===this.method&&this.fsvBalance.toBN().lt(this.fsvPrice))vant.Toast.fail("FSV余额不足！");else if("USDT"===this.method&&this.usdtBalance.toBN().lt(this.usdtPrice))vant.Toast.fail("USDT余额不足！");else if("授权"===this.btnText)return this.approve();var s=this.$contracts["FSV"===this.method?"FSVToken":"USDTToken"].options.address,e=this.$contracts.Genesis.methods.subscribe(s);e.call({from:this.$address},(function(s,n){s||e.send({from:t.$address}).on("transactionHash",(function(s){t.trading=!0})).on("receipt",(function(s){vant.Toast.success("认购成功！"),t.trading=!1,t.$emit("reload"),t.init(),t.show=!1})).on("error",(function(s){t.trading=!1}))}))}}}),c=r,d=c,l=(e("238d"),e("2877")),h=Object(l["a"])(d,n,a,!1,null,"710e608e",null);s["default"]=h.exports},c9b0:function(t,s,e){}}]);